@model Crowdfunding.Models.Company

<link rel="stylesheet" href="~/css/tab.css" />
<link rel="stylesheet" href="~/css/Comments.css" />

<div>
    <h4>@Html.DisplayFor(model => model.Name)</h4>
    <hr />
    <div class="row">
        <div class="col-6">
            <iframe width="560" height="315" src="@ViewBag.Youtube" frameborder="0"
                    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
            </iframe>
        </div>
        <div class="col-6">
            <div class="row">
                <div class="col-4">
                    @Html.DisplayNameFor(model => model.Category)
                </div>
                <div class="col-8">
                    @Html.DisplayFor(model => model.Category.Name)
                </div>
            </div>
            <div class="row">
                <div class="col-4">
                    @Html.DisplayNameFor(model => model.CurrentMoney)
                </div>
                <div class="col-8">
                    @Html.DisplayFor(model => model.CurrentMoney)
                </div>
            </div>
            <div class="row">
                <div class="col-4">
                    @Html.DisplayNameFor(model => model.TargetMoney)
                </div>
                <div class="col-8">
                    @Html.DisplayFor(model => model.TargetMoney)
                </div>
            </div>
            <div class="row">
                <div class="col-4">
                    @Html.DisplayNameFor(model => model.EndDate)
                </div>
                <div class="col-8">
                    @Html.DisplayFor(model => model.EndDate)
                </div>
            </div>
            <div class="row">
                <div class="col-4">
                    @Html.DisplayNameFor(model => model.CustomUser)
                </div>
                <div class="col-8">
                    @Html.DisplayFor(model => model.CustomUser.UserName)
                </div>
            </div>
            <form asp-controller="Bonus" asp-action="Index" asp-route-companyId="@Model.Id">
                <button class="btn btn-sm btn-primary">Support</button>
            </form>
            <div>
                <a asp-action="AllCompanies">Back to List</a>
                @if (User.Identity.Name == Model.CustomUser.UserName || User.IsInRole("Admin"))
                {
                    <a asp-action="Edit" asp-route-id="@Model.Id"> | Edit </a>
                    <a asp-controller="Bonus" asp-action="Create" asp-route-companyId="@Model.Id">| Create New Bonus |</a>
                    <a asp-controller="Bonus" asp-action="Index" asp-route-companyId="@Model.Id">View Bonuses</a>
                }

            </div>
        </div>
    </div>
</div>

<div class="tab">
    <button class="tablinks" value="DescriptionSection">Description</button>
    <button class="tablinks" value="NewsSection">News</button>
    <button class="tablinks" value="CommentsSection" id="defaultTab">Comments</button>
</div>

<div id="DescriptionSection" class="tabcontent">
    <h3>Desctiption</h3>
    <p>@Model.Description</p>
</div>

<div id="NewsSection" class="tabcontent">
    <h3>Paris</h3>
    <p>Paris is the capital of France.</p>
</div>

<div id="CommentsSection" class="tabcontent">    
    <input type="text" hidden value="@User.Identity.Name" id="userName" />
    <input type="text" hidden value="@Model.Id" id="companyId" />

    <div class="row">
        <div class="col-10">
            <input type="text" class="form-control" id="inputComment" />
        </div>
        <div class="col-2">
            <button class="btn btn-primary" id="btnSend">Send</button>
        </div>
    </div>
    <br />
    <div class="container">
        <div class="comments">
            <h3 class="title-comments">Comments</h3>
            <ul class="media-list" id="commentsBoard">
            </ul>   

        </div>
    </div>
</div>





@section Scripts {
    <script>
        $(".tablinks").on("click", function (event) {
            $(".tabcontent").hide();
            $("#" + event.target.getAttribute("value")).fadeIn(1000);
        })
        document.getElementById("defaultTab").click();
    </script>

    <script src="~/js/signalr/dist/browser/signalr.min.js"></script>

    <script>
        const hubConnection = new signalR.HubConnectionBuilder()
            .withUrl("/companies/index").build();

        hubConnection.on("Send", function (comment, userName, companyId) {
            if (companyId != $("#companyId").val()) {return}
            $("<li class='media'>" +
                "<div class='media-body'>" +
                "<div class='media-heading'>" +
                "<div class='author'>" + userName + "</div>" +
                "<div class='metadata'>" +
                "<span class='date'>" + GetCurrentTime() + "</span>" +
                "</div>" +
                "</div>" +
                "<div class='media-text text-justify'>" + comment + "</div>" +
                "<hr>" +
                "</div>" +
                "</li>").appendTo($("#commentsBoard"));
        })

        $("#btnSend").on("click", function () {
            hubConnection.invoke("Send", $("#inputComment").val(), $("#userName").val(),
                $("#companyId").val());

        })

        hubConnection.start();

        function GetCurrentTime() {
            let
                now = new Date(),
                date = now.getDate(),
                month = now.getMonth(),
                year = now.getFullYear(),
                hour = now.getHours(),
                minute = now.getMinutes(),
                second = now.getSeconds();

            minute = (minute < 10) ? '0' + minute : minute;
            second = (second < 10) ? '0' + second : second;
            hour = (hour < 10) ? '0' + hour : hour;
            return (date + "." + month + "." + year + "  " + hour + ":" + minute + ":" + second);
        }
    </script>


}
